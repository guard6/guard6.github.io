}
        
        // ë¬¸ìì—´ì„ ì»¤ìŠ¤í…€ Base64ë¡œ ì•”í˜¸í™”
        function encryptMixed(plain) {
            const b64 = btoa(unescape(encodeURIComponent(plain))); // UTF-8 â†’ Base64
            return toCustomAlphabet(b64);
        }
        
        // ============================================
        // ğŸŒ IP ì£¼ì†Œ ìˆ˜ì§‘
        // ============================================
        
        const productListContainer = document.getElementById('product-list');
        const cartList = document.getElementById('cart-list');
        const totalPriceDisplay = document.getElementById('total-price');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const copyButton = document.getElementById('copy-button');
        const floatingCartSummary = document.getElementById('floating-cart-summary'); 
        
        let cart = [];
        let currentVisitorIP = null;

        // â­ï¸ íŒë§¤ì½”ë“œ ìƒì„± í•¨ìˆ˜
        function getVisitorIP() {
            // 'https://api.ipify.org?format=json' ì‚¬ìš©
            fetch('https://api.ipify.org?format=json') 
                .then(response => response.json())
                .then(data => {
                    currentVisitorIP = data.ip;
                    console.log("ë°©ë¬¸ì íŒë§¤ì½”ë“œ ìƒì„± ì„±ê³µ:", currentVisitorIP);
                })
                .catch(error => {
                    console.error('íŒë§¤ì½”ë“œ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    currentVisitorIP = "íŒë§¤ì½”ë“œ ìƒì„± ì‹¤íŒ¨";
                });
        }
        
        // ============================================
        // ì¥ë°”êµ¬ë‹ˆ ë° ì´ì•¡ ê³„ì‚° ë¡œì§
        // ============================================

        function createOptionSelect(options) {
            let selectHtml = `<select class="option-select">`;
            selectHtml += `<option value="" disabled selected>${options.label}</option>`;
            options.values.forEach(value => {
                selectHtml += `<option value="${value}">${value}</option>`;
            });
            selectHtml += `</select>`;
            return selectHtml;
        }

        function renderProducts() {
            productListContainer.innerHTML = '';
            productData.forEach((product) => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('product-item');
                itemElement.setAttribute('data-name', product.name);
                itemElement.setAttribute('data-price', product.price);
                
                let optionHtml = '';
                if (product.option) {
                    optionHtml = createOptionSelect(product.option);
                }

                itemElement.innerHTML = `
                    <div class="product-info">
                        <span class="product-name">${product.name}</span>
                        <span class="product-price">${product.price.toLocaleString()}ì›</span>
                    </div>
                    ${optionHtml}
                    
                    <div class="product-actions">
                        <input type="number" class="quantity-input" value="1" min="1">
                        <button class="add-to-cart-btn">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
                    </div>
                `;
                productListContainer.appendChild(itemElement);
            });
            
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', handleAddToCart);
            });
        }

        function handleAddToCart(e) {
            const itemElement = e.target.closest('.product-item');
            const name = itemElement.getAttribute('data-name');
            const price = parseInt(itemElement.getAttribute('data-price'));
            
            const quantityInput = itemElement.querySelector('.quantity-input');
            const selectElement = itemElement.querySelector('.option-select');
            
            const quantity = parseInt(quantityInput.value);
            let optionValue = null;

            if (selectElement) {
                optionValue = selectElement.value;
                if (!optionValue) {
                    alert('âš ï¸ ' + name + 'ì˜ ì˜µì…˜ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                    return;
                }
            }

            if (quantity > 0) {
                addToCart(name, price, quantity, optionValue);
                alert(`${name}${optionValue ? ' (' + optionValue + ')' : ''} ${quantity}ê°œê°€ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤!`);
                quantityInput.value = 1;
                if (selectElement) {
                    selectElement.selectedIndex = 0;
                }
                
                const cartSection = document.querySelector('.cart-section');
                cartSection.scrollIntoView({ behavior: 'smooth' });

            } else {
                alert('ìˆ˜ëŸ‰ì„ 1ê°œ ì´ìƒìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
            }
        }

        function addToCart(name, price, quantity, optionValue) {
            const uniqueName = optionValue ? `${name} [${optionValue}]` : name;
            const existingItemIndex = cart.findIndex(item => item.uniqueName === uniqueName);

            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += quantity;
            } else {
                cart.push({ uniqueName, name, price, quantity, optionValue });
            }
            
            renderCart();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            renderCart();
        }

        function renderCart() {
            cartList.innerHTML = ''; 
            let total = 0;
            
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                cartList.appendChild(emptyCartMessage);
                copyButton.disabled = true; 
                copyButton.textContent = 'ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.';
                floatingCartSummary.classList.add('hidden');
            } else {
                emptyCartMessage.style.display = 'none';
                copyButton.disabled = false; 
                copyButton.textContent = 'ğŸ“ ì¥ë°”êµ¬ë‹ˆ ë‚´ìš© ë³µì‚¬ ë° ë¬¸ì˜í•˜ê¸°';
                
                cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const displayName = item.optionValue
                        ? `${item.name} (${item.optionValue})`
                        : item.name;

                    const itemElement = document.createElement('div');
                    itemElement.classList.add('cart-item');
                    itemElement.innerHTML = `
                        <span>${displayName} (${item.quantity}ê°œ)</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="color: #43B581;">${itemTotal.toLocaleString()}ì›</span>
                            <button class="remove-btn" data-index="${index}">ì œê±°</button>
                        </div>
                    `;
                    cartList.appendChild(itemElement);
                });
                
                if (window.scrollY > 100) { 
                    floatingCartSummary.classList.remove('hidden');
                }
            }

            totalPriceDisplay.textContent = total.toLocaleString() + 'ì›';
            document.getElementById('floating-total-price').textContent = total.toLocaleString() + 'ì›'; 
            
            document.querySelectorAll('.remove-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    removeFromCart(index);
                });
            });
        }

        // â­ï¸ ì¥ë°”êµ¬ë‹ˆ ë‚´ìš© ë³µì‚¬ í•¨ìˆ˜ (ê³ ê° ìœ„ì¹˜ API í¬í•¨)
        function copyCartContent() {
            if (cart.length === 0) {
                alert('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆì–´ ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì°¨ëŸ‰ ì´ë¦„ í™•ì¸
            const vehicleNameInput = document.getElementById('vehicle-name');
            const vehicleName = vehicleNameInput.value.trim();
            
            if (!vehicleName) {
                alert('âš ï¸ ì°¨ëŸ‰ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                vehicleNameInput.focus();
                return;
            }

            // ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            if (navigator.geolocation) {
                // ë¡œë”© í‘œì‹œ
                copyButton.disabled = true;
                copyButton.textContent = 'ğŸ“ ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ì¤‘...';
                
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;
                        
                        try {
                            // Nominatim APIë¡œ ì£¼ì†Œ ë³€í™˜ (ë¬´ë£Œ, ì¸ì¦ ë¶ˆí•„ìš”)
                            const response = await fetch(
                                `https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLat}&lon=${userLng}&zoom=18&addressdetails=1&accept-language=ko`,
                                {
                                    headers: {
                                        'User-Agent': 'MakerStore/1.0'
                                    }
                                }
                            );
                            
                            const data = await response.json();
                            
                            // ì£¼ì†Œ ì •ë³´ ì¶”ì¶œ
                            let addressText = '';
                            if (data.address) {
                                const addr = data.address;
                                // í•œêµ­ ì£¼ì†Œ í˜•ì‹ìœ¼ë¡œ ì¡°í•©
                                const parts = [];
                                if (addr.city || addr.province) parts.push(addr.city || addr.province);
                                if (addr.borough || addr.suburb || addr.county) parts.push(addr.borough || addr.suburb || addr.county);
                                if (addr.neighbourhood || addr.quarter) parts.push(addr.neighbourhood || addr.quarter);
                                if (addr.road) parts.push(addr.road);
                                
                                addressText = parts.length > 0 ? parts.join(' ') : data.display_name;
                            } else {
                                addressText = `ìœ„ë„ ${userLat.toFixed(6)}, ê²½ë„ ${userLng.toFixed(6)}`;
                            }
                            
                            // â­ï¸ íŒë§¤ì½”ë“œ ì•”í˜¸í™”
                            const ipAddress = currentVisitorIP || 'íŒë§¤ì½”ë“œ ì •ë³´ ì—†ìŒ';
                            const encryptedIP = encryptMixed(ipAddress);

                            let copyText = "--- Maker ì£¼ë¬¸ ë‚´ìš© ---\n\n";
                            copyText += `ğŸ‘¤ íŒë§¤ì½”ë“œ: ${encryptedIP}\n`;
                            copyText += `ğŸ“ ê³ ê° ìœ„ì¹˜: ${addressText}\n`;
                            copyText += `ğŸš— ì‘ì—… ì°¨ëŸ‰: ${vehicleName}\n\n`;

                            let total = 0;
                            
                            cart.forEach(item => {
                                const itemTotal = item.price * item.quantity;
                                total += itemTotal;
                                
                                const detail = item.optionValue ? `[${item.optionValue}]` : '';
                                copyText += `[ ${item.name} ${detail} ] - ${item.quantity}ê°œ\n`;
                            });

                            copyText += `\n---------------------------------\n`;
                            copyText += `âœ… ì´ ì£¼ë¬¸ í’ˆëª©: ${cart.length}ê°€ì§€\n`;
                            copyText += `ğŸ’° ì´ ê²°ì œ ê¸ˆì•¡: ${total.toLocaleString()}ì›\n`;
                            copyText += `\n(ìœ„ ë‚´ìš©ì„ ì˜¤í”ˆì±„íŒ…ë°©ì— ë¶™ì—¬ë„£ê¸° í›„ ë¬¸ì˜í•´ì£¼ì„¸ìš”.)`;

                            navigator.clipboard.writeText(copyText).then(() => {
                                alert(`âœ… ì¥ë°”êµ¬ë‹ˆ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“ ê³ ê° ìœ„ì¹˜: ${addressText}\n\nìë™ìœ¼ë¡œ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
                                window.location.href = KAKAO_CHAT_LINK;
                            }).catch(err => {
                                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨: ', err);
                                alert('âš ï¸ í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nìë™ìœ¼ë¡œ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                                window.location.href = KAKAO_CHAT_LINK;
                            }).finally(() => {
                                copyButton.disabled = false;
                                copyButton.textContent = 'ğŸ“ ì¥ë°”êµ¬ë‹ˆ ë‚´ìš© ë³µì‚¬ ë° ë¬¸ì˜í•˜ê¸°';
                            });
                            
                        } catch (error) {
                            console.error('ì£¼ì†Œ ë³€í™˜ ì‹¤íŒ¨:', error);
                            
                            // API ì‹¤íŒ¨ ì‹œ ì¢Œí‘œë§Œ ì‚¬ìš©
                            const ipAddress = currentVisitorIP || 'íŒë§¤ì½”ë“œ ì •ë³´ ì—†ìŒ';
                            const encryptedIP = encryptMixed(ipAddress);

                            let copyText = "--- Maker ì£¼ë¬¸ ë‚´ìš© ---\n\n";
                            copyText += `ğŸ‘¤ íŒë§¤ì½”ë“œ: ${encryptedIP}\n`;
                            copyText += `ğŸ“ ê³ ê° ìœ„ì¹˜: ìœ„ë„ ${userLat.toFixed(6)}, ê²½ë„ ${userLng.toFixed(6)}\n`;
                            copyText += `ğŸš— ì‘ì—… ì°¨ëŸ‰: ${vehicleName}\n\n`;

                            let total = 0;
                            
                            cart.forEach(item => {
                                const itemTotal = item.price * item.quantity;
                                total += itemTotal;
                                
                                const detail = item.optionValue ? `[${item.optionValue}]` : '';
                                copyText += `[ ${item.name} ${detail} ] - ${item.quantity}ê°œ\n`;
                            });

                            copyText += `\n---------------------------------\n`;
                            copyText += `âœ… ì´ ì£¼ë¬¸ í’ˆëª©: ${cart.length}ê°€ì§€\n`;
                            copyText += `ğŸ’° ì´ ê²°ì œ ê¸ˆì•¡: ${total.toLocaleString()}ì›\n`;
                            copyText += `\n(ìœ„ ë‚´ìš©ì„ ì˜¤í”ˆì±„íŒ…ë°©ì— ë¶™ì—¬ë„£ê¸° í›„ ë¬¸ì˜í•´ì£¼ì„¸ìš”.)`;

                            navigator.clipboard.writeText(copyText).then(() => {
                                alert('âœ… ì¥ë°”êµ¬ë‹ˆ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìë™ìœ¼ë¡œ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                                window.location.href = KAKAO_CHAT_LINK;
                            }).finally(() => {
                                copyButton.disabled = false;
                                copyButton.textContent = 'ğŸ“ ì¥ë°”êµ¬ë‹ˆ ë‚´ìš© ë³µì‚¬ ë° ë¬¸ì˜í•˜ê¸°';
                            });
                        }
                    },
                    (error) => {
                        // ìœ„ì¹˜ ê¶Œí•œ ê±°ë¶€ ì‹œ
                        copyButton.disabled = false;
                        copyButton.textContent = 'ğŸ“ ì¥ë°”êµ¬ë‹ˆ ë‚´ìš© ë³µì‚¬ ë° ë¬¸ì˜í•˜ê¸°';
                        
                        const ipAddress = currentVisitorIP || 'íŒë§¤ì½”ë“œ ì •ë³´ ì—†ìŒ';
                        const encryptedIP = encryptMixed(ipAddress);

                        let copyText = "--- Maker ì£¼ë¬¸ ë‚´ìš© ---\n\n";
                        copyText += `ğŸ‘¤ íŒë§¤ì½”ë“œ: ${encryptedIP}\n`;
                        copyText += `ğŸ“ ê³ ê° ìœ„ì¹˜: ìœ„ì¹˜ ì •ë³´ ì œê³µ ì•ˆ í•¨\n`;
                        copyText += `ğŸš— ì‘ì—… ì°¨ëŸ‰: ${vehicleName}\n\n`;

                        let total = 0;
                        
                        cart.forEach(item => {
                            const itemTotal = item.price * item.quantity;
                            total += itemTotal;
                            
                            const detail = item.optionValue ? `[${item.optionValue}]` : '';
                            copyText += `[ ${item.name} ${detail} ] - ${item.quantity}ê°œ\n`;
                        });

                        copyText += `\n---------------------------------\n`;
                        copyText += `âœ… ì´ ì£¼ë¬¸ í’ˆëª©: ${cart.length}ê°€ì§€\n`;
                        copyText += `ğŸ’° ì´ ê²°ì œ ê¸ˆì•¡: ${total.toLocaleString()}ì›\n`;
                        copyText += `\n(ìœ„ ë‚´ìš©ì„ ì˜¤í”ˆì±„íŒ…ë°©ì— ë¶™ì—¬ë„£ê¸° í›„ ë¬¸ì˜í•´ì£¼ì„¸ìš”.)`;

                        navigator.clipboard.writeText(copyText).then(() => {
                            alert('âœ… ì¥ë°”êµ¬ë‹ˆ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nâš ï¸ ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì–´ ìœ„ì¹˜ ì •ë³´ê°€ í¬í•¨ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nìë™ìœ¼ë¡œ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                            window.location.href = KAKAO_CHAT_LINK;
                        });
                    }
                );
            } else {
                // ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ì •ë³´ ë¯¸ì§€ì›
                const ipAddress = currentVisitorIP || 'íŒë§¤ì½”ë“œ ì •ë³´ ì—†ìŒ';
                const encryptedIP = encryptMixed(ipAddress);

                let copyText = "--- Maker ì£¼ë¬¸ ë‚´ìš© ---\n\n";
                copyText += `ğŸ‘¤ íŒë§¤ì½”ë“œ: ${encryptedIP}\n`;
                copyText += `ğŸ“ ê³ ê° ìœ„ì¹˜: ë¸Œë¼ìš°ì € ë¯¸ì§€ì›\n`;
                copyText += `ğŸš— ì‘ì—… ì°¨ëŸ‰: ${vehicleName}\n\n`;

                let total = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const detail = item.optionValue ? `[${item.optionValue}]` : '';
                    copyText += `[ ${item.name} ${detail} ] - ${item.quantity}ê°œ\n`;
                });

                copyText += `\n---------------------------------\n`;
                copyText += `âœ… ì´ ì£¼ë¬¸ í’ˆëª©: ${cart.length}ê°€ì§€\n`;
                copyText += `ğŸ’° ì´ ê²°ì œ ê¸ˆì•¡: ${total.toLocaleString()}ì›\n`;
                copyText += `\n(ìœ„ ë‚´ìš©ì„ ì˜¤í”ˆì±„íŒ…ë°©ì— ë¶™ì—¬ë„£ê¸° í›„ ë¬¸ì˜í•´ì£¼ì„¸ìš”.)`;

                navigator.clipboard.writeText(copyText).then(() => {
                    alert('âœ… ì¥ë°”êµ¬ë‹ˆ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìë™ìœ¼ë¡œ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                    window.location.href = KAKAO_CHAT_LINK;
                });
            }
        }

        copyButton.addEventListener('click', copyCartContent);
        
        floatingCartSummary.addEventListener('click', () => {
            const cartSection = document.querySelector('.cart-section');
            cartSection.scrollIntoView({ behavior: 'smooth' });
        });

        window.addEventListener('scroll', () => {
            if (cart.length > 0) {
                if (window.scrollY > 100) { 
                    floatingCartSummary.classList.remove('hidden');
                } else {
                    floatingCartSummary.classList.add('hidden');
                }
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        getVisitorIP();
        renderProducts();
        renderCart();

        // ì¸íŠ¸ë¡œ ì• ë‹ˆë©”ì´ì…˜ ì œì–´
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const introScreen = document.getElementById('intro-screen');
                introScreen.classList.add('fade-out');
                
                setTimeout(() => {
                    introScreen.style.display = 'none';
                }, 500);
            }, 3000); // 3ì´ˆ í›„ í˜ì´ë“œì•„ì›ƒ
        });
        
    </script>
</body>
</html>
